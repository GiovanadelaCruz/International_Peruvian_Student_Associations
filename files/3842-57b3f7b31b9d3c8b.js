(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3842],{26452:e=>{var t=Math.floor;e.exports=function(e,n){var s="";if(!e||n<1||n>0x1fffffffffffff)return s;do n%2&&(s+=e),(n=t(n/2))&&(e+=e);while(n);return s}},19929:(e,t,n)=>{var s=n(26452),o=n(52291),i=n(28931),r=n(83417),a=n(91090),c=n(4618),l=Math.ceil;e.exports=function(e,t){var n=(t=void 0===t?" ":o(t)).length;if(n<2)return n?s(t,e):t;var d=s(t,l(e/a(t)));return r(t)?i(c(d),0,e).join(""):d.slice(0,e)}},70156:(e,t,n)=>{var s=n(19929),o=n(91090),i=n(67642),r=n(95243);e.exports=function(e,t,n){e=r(e);var a=(t=i(t))?o(e):0;return t&&a<t?s(t-a,n)+e:e}},13040:(e,t,n)=>{"use strict";n.d(t,{b9:()=>p,go:()=>u,iJ:()=>d,iO:()=>h});var s=n(14041),o=n(27132),i=n(64225),r=n(15562),a=n(40269),c=n(26488),l=n(5720);let d=()=>{let e=(0,s.useRef)("unsynced"),t=(0,i.CU)(),n=(0,r.O)(),c=(0,s.useCallback)(async(s,o,i)=>{if((0,l.yy)(t.getState())||n){if("unsynced"!==e.current){console.warn("Cannot load doc from cache when it is already ".concat(e.current));return}await (0,a.f)().loadYDoc(s,o)&&(e.current="loaded",i())}},[n,t]),d=(0,s.useCallback)((s,i)=>{if(!((0,l.yy)(t.getState())||n))return;let r=(0,o.S)();if("unsynced"!==e.current){console.warn("Cannot sync doc to cache when it is already ".concat(e.current));return}r&&(0,a.f)().syncYDoc(s,i)},[n,t]);return(0,s.useMemo)(()=>({loadYDoc:c,syncYDoc:d}),[c,d])},u=()=>{let e=(0,i.jL)(),t=(0,i.CU)();return(0,s.useCallback)(function(n){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();(0,l.yy)(t.getState())&&e((0,l.KT)({docIds:n,lastSynced:s}))},[e,t])},h=()=>{let e=(0,i.jL)(),t=(0,i.CU)();return(0,s.useCallback)(function(n){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date().toISOString();if((0,l.yy)(t.getState()))return e((0,l.yK)({docId:n,lastSynced:s}))},[e,t])},p=()=>(0,s.useMemo)(()=>(0,c.S)(),[])},15562:(e,t,n)=>{"use strict";n.d(t,{O:()=>i});var s=n(33854),o=n(13040);let i=()=>{let e=(0,s.u)("offlineEditing"),t=(0,o.b9)();return e&&t}},85500:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});var s=n(31085),o=n(32133),i=n(70184),r=n(4588);let a=e=>{let{...t}=e,{reduxData:n,...a}=t,c=(0,i.F)(n);return(0,s.jsx)(o.Kq,{store:c,children:(0,s.jsx)(r.b,{...a,readOnly:!0,isStatic:!0,animationsEnabled:!1})})}},89876:(e,t,n)=>{"use strict";n.d(t,{k5:()=>r,HC:()=>i,f$:()=>a});var s=n(5377),o=n(8558);let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return(0,s.createDocWithCards)(t,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:o.f.DefaultTitle}},{type:"contributors"}]}]},{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"heading"}]}]}])},r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.createDocWithCards)(e,[{type:"card",content:[{type:"cardLayoutItem",attrs:{itemId:"body"},content:[{type:"title",attrs:{level:o.f.DefaultTitle}}]}]}])},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{docFlags:{}};return{type:"doc",content:[{type:"document",attrs:t,content:[{type:"card",content:[{type:"title",attrs:{level:o.f.DefaultTitle}},{type:"contributors"}]},{type:"card",attrs:{previewContent:null,background:{type:"none"},container:{},cardSize:"default",layout:"blank"},content:[{type:"heading",attrs:{horizontalAlign:null,level:2},content:[{type:"text",text:"Quick Start Checklist"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"zap",native:"⚡"}},{type:"text",text:"️ "},{type:"text",marks:[{type:"bold"}],text:"Type "},{type:"text",marks:[{type:"code"}],text:"/"},{type:"text",marks:[{type:"bold"}],text:" in a card to open the slash menu"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"It lets you browse and add content blocks quickly"}]},{type:"bullet",attrs:{indent:1,fontSize:null},content:[{type:"text",text:"Content blocks can be added from the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"7jZEg"}}],text:"insert menu"},{type:"footnote",attrs:{noteId:"7jZEg"},content:[{type:"image",attrs:{id:"Y3FmX",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/b98e59519a994c7abd900f44683bbb5d/optimized/insert-menu-explainer.gif",tempUrl:"blob:https://gamma.app/983566b4-f21e-4d28-bc69-d448c1976833",uploadStatus:0,meta:{width:700,height:459,date_file_modified:"2023/01/20 23:08:42 GMT",duration:4.42,aspect_ratio:1.525,has_clipping_path:!1,frame_count:36,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"insert-menu-explainer.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" if you prefer to drag"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"heavy_plus_sign",native:"➕"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add a new card"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/card"},{type:"text",text:") or select a template via the "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"xLt8J"}}],text:"plus button"},{type:"footnote",attrs:{noteId:"xLt8J"},content:[{type:"image",attrs:{id:"3CSXR",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/a8d6b7149f75401ebd54e6b022670a3e/optimized/image.png",tempUrl:"blob:https://gamma.app/5368f25a-cf30-4410-bf62-bd26080b01f5",uploadStatus:0,meta:{width:844,height:608,date_file_modified:"2023/01/20 21:38:09 GMT",aspect_ratio:1.388,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#f7f5f5"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"newspaper",native:"\uD83D\uDCF0"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Create multi-column layouts"},{type:"text",text:" (type "},{type:"text",marks:[{type:"code"}],text:"/columns"},{type:"text",text:") or "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"JyryA"}}],text:"drag blocks"},{type:"footnote",attrs:{noteId:"JyryA"},content:[{type:"image",attrs:{id:"iJXTh",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/3e47c137ba5d4d13bdafda584b3a8f94/optimized/drag-columns-optimized.gif",tempUrl:"blob:https://gamma.app/654cd2e0-6972-4a24-a7c0-25eff0cf9050",uploadStatus:0,meta:{width:500,height:313,date_file_modified:"2023/01/20 21:35:04 GMT",duration:9.83,aspect_ratio:1.597,has_clipping_path:!1,frame_count:62,colorspace:"RGB",average_color:"#e8cac5"},providerMeta:null,name:"drag-columns-optimized.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" side by side"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"bridge_at_night",native:"\uD83C\uDF09"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Add an image "},{type:"text",text:"(type "},{type:"text",marks:[{type:"code"}],text:"/image"},{type:"text",text:"). You can drag in or paste image files too!"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"art",native:"\uD83C\uDFA8"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Change the deck "},{type:"text",marks:[{type:"bold"},{type:"footnoteLabel",attrs:{noteId:"mTOBc"}}],text:"theme"},{type:"footnote",attrs:{noteId:"mTOBc"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Click the "},{type:"text",marks:[{type:"code"}],text:"Theme"},{type:"text",text:" button in the top toolbar, then try clicking some of the different options"}]},{type:"image",attrs:{id:"GHNdu",horizontalAlign:"center",src:"https://cdn.gamma.app/zc87vhr30n8uf3n/db839cee72b7497b9ff1424987641ed5/optimized/image.png",tempUrl:null,uploadStatus:0,meta:{width:806,height:1678,date_file_modified:"2022/08/01 23:13:09 GMT",aspect_ratio:.48,has_clipping_path:!1,frame_count:1,colorspace:"RGB",average_color:"#ccc7ca"},providerMeta:null,name:"image.png",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:"inset",clipPath:["17.31441903150651%","0%","41.5572854690296%","0%"],clipAspectRatio:1.1678975712005124,width:209.77777777777777}}}]},{type:"text",text:" to give it a different look and feel"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"arrow_forward",native:"▶️"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Try present mode"},{type:"text",text:" and use your arrow keys and "},{type:"text",marks:[{type:"footnoteLabel",attrs:{noteId:"UGnAU"}}],text:"spotlight"},{type:"footnote",attrs:{noteId:"UGnAU"},content:[{type:"paragraph",attrs:{horizontalAlign:null,fontSize:null},content:[{type:"text",text:"Spotlight lets you"},{type:"text",marks:[{type:"bold"}],text:" focus "},{type:"text",text:"on"},{type:"text",marks:[{type:"bold"}],text:" one piece of content at a time. "},{type:"text",text:"While presenting, press "},{type:"text",marks:[{type:"code"}],text:"s"},{type:"text",text:" to enter spotlight mode."}]},{type:"image",attrs:{id:"YOFhU",horizontalAlign:null,src:"https://cdn.gamma.app/zc87vhr30n8uf3n/ed0b362f6c2f4a438cd3188ba7697a02/optimized/spotlight-compressed.gif",tempUrl:"blob:https://gamma.app/d2eaae7f-515e-4e06-b396-4b0551a5a999",uploadStatus:0,meta:{width:1200,height:750,date_file_modified:"2023/01/13 21:48:00 GMT",duration:6.66,aspect_ratio:1.6,has_clipping_path:!1,frame_count:34,colorspace:"RGB",average_color:"#323030"},providerMeta:null,name:"spotlight-compressed.gif",query:null,source:"image.custom",showPlaceholder:!1,fullWidthBlock:!1,resize:{clipType:null,clipPath:null,clipAspectRatio:null,width:null}}}]},{type:"text",text:" to move around"}]},{type:"todo",attrs:{indent:0,checked:!1,fontSize:null},content:[{type:"emoji",attrs:{id:"tada",native:"\uD83C\uDF89"}},{type:"text",text:" "},{type:"text",marks:[{type:"bold"}],text:"Share your deck"},{type:"text",text:"."},{type:"text",marks:[{type:"bold"}],text:" "},{type:"text",text:"Publish it to the world, invite others, or export a PDF"}]}]}]}]}}},52743:(e,t,n)=>{"use strict";n.d(t,{Q:()=>r});var s=n(13236),o=n(55810),i=n(4001);let r=s.YY.create({name:"animations",addOptions:()=>({}),addCommands:()=>({addAnimationPositions:(e,t)=>n=>{let{state:s,dispatch:o}=n;return o&&s.tr.setMeta(i.g,{type:"addAnimationPositions",isPresentMode:t,pos:e}),!0},enableAnimations:e=>t=>{let{state:n,dispatch:s}=t;return s&&n.tr.setMeta(i.g,{type:"enableAnimations",enabled:e}),!0},resetAnimationPositions:e=>t=>{let{state:n,dispatch:s}=t;return s&&n.tr.setMeta(i.g,{type:"resetAnimationPositions",isPresentMode:e}),!0}}),addProseMirrorPlugins:()=>[(0,o.ZY)()]})},55810:(e,t,n)=>{"use strict";n.d(t,{GO:()=>T,h3:()=>E,wn:()=>D,SS:()=>P,ZY:()=>R,er:()=>k,Gi:()=>I});var s=n(81313),o=n(13236),i=n(81570),r=n(73686),a=n(64225),c=n(5933),l=n(14e3),d=n(19534),u=n(17119);let h=e=>"buttonGroup"===e.type.name;var p=n(34821),g=n(69646),f=n(42849),m=n(17835),y=n(63915),b=n(86047),w=n(34095),v=n(4001),S=n(3583),A=n(96712);let C=()=>({absPositions:[],relPositions:[]});class x{getPositions(e){return e?this.presentModePositions:this.editModePositions}apply(e,t){let n=e.getMeta(v.g);if(n)switch(n.type){case"addAnimationPositions":this.addAnimationPositions(n.pos,t,n.isPresentMode);break;case"resetAnimationPositions":this.resetAnimationPositions(n.isPresentMode);break;case"enableAnimations":this.enabled=n.enabled;break;default:console.warn("AnimationsState: unknown action type",n)}return this}addAnimationPositions(e,t,n){let s=this.getPositions(n),o=Math.max(...s.absPositions);e.forEach(e=>{if(e<=o)return;s.absPositions.push(e);let n=(0,A.JO)(t,e);n&&s.relPositions.push(n)})}resetAnimationPositions(e){e?this.presentModePositions=C():this.editModePositions=C()}getAnimationPositionsAbs(e,t){let n=S.pJ.getState(e),s=this.getPositions(t);return n?s.relPositions.map(t=>(0,A.d_)(e,t)).filter(Boolean):s.absPositions}constructor(){this.enabled=!0,this.presentModePositions=C(),this.editModePositions=C()}}let k="animate-has-animated",E="animatable-on-load",T="animatable-on-load-as-block",P="animatable-on-load-content-parent",D="animatable-on-load-content-child",M=e=>{switch(e.type.name){case"card":return!0===(0,g.Wq)(e);case"cardAccentLayoutItem":return(0,f.wL)(e);case"calloutBox":case"gallery":case"smartLayout":case"divider":return!0;default:return(0,b.Rj)(e)}},O=(e,t)=>(0,y.q)(e)||(0,m.qK)(t),I=(e,t)=>{let n=e.view.state.doc.resolve(t);if(!n)return;let s=e.state.doc.nodeAt(t);if(s&&M(s)&&!O(s,n)){let e=s.isLeaf||s.isAtom?0:-1;return{pos:n.pos+e,start:n.pos,depth:n.depth,node:s}}return(0,o.eL)(n,M)},_=(e,t)=>{let n=t.getAnimationPositionsAbs(e,(0,c.wC)((0,a.KA)().getState())===l.w.SLIDE_VIEW).reduce((e,t)=>Math.max(e,t),0),s=e.doc.nodeAt(n),o=s&&n>0?s.nodeSize:0;return n+o},R=()=>new i.k_({key:v.g,state:{init:()=>new x,apply:(e,t,n,s)=>t.apply(e,s)},props:{decorations(e){let t=[],n=this.getState(e);if(!1===n.enabled)return r.zF.create(e.doc,t);let o=_(e,n);return e.doc.descendants((n,i,a,c)=>{let l=e.doc.resolve(i),g=M(n)||O(n,l);if(i<o&&g&&t.push(r.NZ.node(i,i+n.nodeSize,{class:k})),(0,y.M)(n)||(0,m.Pb)(n))t.push(r.NZ.node(i,i+n.nodeSize,{class:P}));else if(h(n)||(0,p.q)(n)||(0,w.hj)(n))t.push(r.NZ.node(i,i+n.nodeSize,{class:T}));else if(O(n,l))t.push(r.NZ.node(i,i+n.nodeSize,{class:D,style:"--animate-index: ".concat(c+1)}));else if(M(n)){let e=!!a&&(0,u.Ti)(n,a),o=n.isAtom;t.push(r.NZ.node(i,i+n.nodeSize,{class:(0,s.cx)(E,e&&"animatable-on-load-annotatable",o&&"animatable-on-load-atom")})),(0,f.wL)(n)&&t.push(r.NZ.node(i,i+n.nodeSize,{class:"animatable-on-load-accent"}))}return!((0,d.jg)(n)&&l.depth>1||(0,y.q)(n)||h(n)||(0,p.q)(n)||(0,w.hj)(n))}),r.zF.create(e.doc,t)}}})},4001:(e,t,n)=>{"use strict";n.d(t,{g:()=>s});let s=new(n(81570)).hs("animation")},88203:(e,t,n)=>{"use strict";n.d(t,{b:()=>a,o:()=>c});var s=n(13236),o=n(81570),i=n(76285);let r=new o.hs("yDocSize"),a=e=>{let t=r.getState(e.state);return t?t.getYDocSize():null},c=s.YY.create({name:"yDocSize",addProseMirrorPlugins(){let{document:e}=this.options;return[new o.k_({key:r,state:{init:()=>new l(e),apply:(e,t)=>t}})]}});class l{getYDocSize(){return i.PR(this.ydoc).byteLength}constructor(e){this.ydoc=e}}},35987:(e,t,n)=>{"use strict";n.d(t,{R:()=>d,k:()=>l});var s=n(46343),o=n.n(s),i=n(14041),r=n(64225),a=n(5933),c=n(86047);let l=e=>{let t=(0,r.GV)(a.FI,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o()(...t)});return(0,i.useMemo)(()=>({enabled:!!(e&&t&&(0,c.UE)(e,t)),pos:null==t?void 0:t.pos}),[e,t])},d=e=>{let t=(0,r.GV)(a.e4),n=(0,r.GV)(a._I,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return o()(...t)});(0,i.useEffect)(()=>{if(!e||!t||!n)return;console.debug("[useScrollAndSpotlightSync] collaboratorBeingFollowed spotlight or scroll changed",JSON.stringify(n,null,2));let{spotlight:s,scroll:o}=n;e.commands.syncSpotlightAndScroll({spotlight:s,scroll:o,scrollOffset:100,isFollowing:!0})},[e,t,n])}},43167:(e,t,n)=>{"use strict";n.d(t,{Li:()=>s.Li,Rf:()=>o.R,kY:()=>o.k});var s=n(86047),o=n(35987)},33842:(e,t,n)=>{"use strict";let s;n.d(t,{H2:()=>ov,bw:()=>tq.b,u5:()=>oA.u,k5:()=>oS.k5,HC:()=>oS.HC,f$:()=>oS.f$});var o,i,r,a,c=n(73686);c.Lz.prototype.updateState=function(e){this.docView&&this.updateStateInner(e,this.state.plugins!=e.plugins)};var l=n(31085),d=n(80532),u=n(35789),h=n(35687),p=n(43342),g=n(61778);let f=Math.floor,m=(e,t)=>e<t?e:t,y=(e,t)=>e>t?e:t,b=Number.MAX_SAFE_INTEGER,w="undefined"!=typeof TextEncoder?new TextEncoder:null,v=w?e=>w.encode(e):e=>{let t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s},S="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});S&&1===S.decode(new Uint8Array).length&&(S=null);let A=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},C=(e,t)=>{for(;t>127;)A(e,128|127&t),t=f(t/128);A(e,127&t)},x=new Uint8Array(3e4),k=x.length/3,E=w&&w.encodeInto?(e,t)=>{if(t.length<k){let n=w.encodeInto(t,x).written||0;C(e,n);for(let t=0;t<n;t++)A(e,x[t])}else P(e,v(t))}:(e,t)=>{let n=unescape(encodeURIComponent(t)),s=n.length;C(e,s);for(let t=0;t<s;t++)A(e,n.codePointAt(t))},T=(e,t)=>{let n=e.cbuf.length,s=e.cpos,o=m(n-s,t.length),i=t.length-o;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(y(2*n,i)),e.cbuf.set(t.subarray(o)),e.cpos=i)},P=(e,t)=>{C(e,t.byteLength),T(e,t)},D=e=>Error(e),M=D("Unexpected end of array"),O=D("Integer out of Range"),I=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},_=e=>I(e,N(e)),R=e=>e.arr[e.pos++],N=e=>{let t=0,n=1,s=e.arr.length;for(;e.pos<s;){let s=e.arr[e.pos++];if(t+=(127&s)*n,n*=128,s<128)return t;if(t>b)throw O}throw M},U=S?e=>S.decode(_(e)):e=>{let t=N(e);if(0===t)return"";{let n=String.fromCodePoint(R(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(R(e));else for(;t>0;){let s=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,o),t-=s}return decodeURIComponent(escape(n))}};!function(e){e[e.Token=0]="Token",e[e.PermissionDenied=1]="PermissionDenied",e[e.Authenticated=2]="Authenticated"}(o||(o={}));let L=(e,t)=>{C(e,o.Token),E(e,t)},j=(e,t,n)=>{switch(N(e)){case o.PermissionDenied:t(U(e));break;case o.Authenticated:n(U(e))}},z={code:1009},H={code:4401,reason:"Unauthorized"},F={code:4403},B=e=>Array.from(e.entries()).map(([e,t])=>({clientId:e,...t}));!function(e){e[e.Connecting=0]="Connecting",e[e.Open=1]="Open",e[e.Closing=2]="Closing",e[e.Closed=3]="Closed"}(i||(i={}));var V=n(76285);async function G(e){return new Promise((t,n)=>{setTimeout(t,e)})}function W(e,t){let n=t.delay;if(0===n)return 0;if(t.factor&&(n*=Math.pow(t.factor,e.attemptNum-1),0!==t.maxDelay&&(n=Math.min(n,t.maxDelay))),t.jitter){let e=Math.ceil(t.minDelay);n=Math.floor(Math.random()*(Math.floor(n)-e+1))+e}return Math.round(n)}async function $(e,t){var n;let s=((n=t)||(n={}),{delay:void 0===n.delay?200:n.delay,initialDelay:void 0===n.initialDelay?0:n.initialDelay,minDelay:void 0===n.minDelay?0:n.minDelay,maxDelay:void 0===n.maxDelay?0:n.maxDelay,factor:void 0===n.factor?0:n.factor,maxAttempts:void 0===n.maxAttempts?3:n.maxAttempts,timeout:void 0===n.timeout?0:n.timeout,jitter:!0===n.jitter,handleError:void 0===n.handleError?null:n.handleError,handleTimeout:void 0===n.handleTimeout?null:n.handleTimeout,beforeAttempt:void 0===n.beforeAttempt?null:n.beforeAttempt,calculateDelay:void 0===n.calculateDelay?null:n.calculateDelay});for(let e of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){let t=s[e];if(!Number.isInteger(t)||t<0)throw Error(`Value for ${e} must be an integer greater than or equal to 0`)}if(s.factor.constructor!==Number||s.factor<0)throw Error("Value for factor must be a number greater than or equal to 0");if(s.delay<s.minDelay)throw Error(`delay cannot be less than minDelay (delay: ${s.delay}, minDelay: ${s.minDelay}`);let o={attemptNum:0,attemptsRemaining:s.maxAttempts?s.maxAttempts:-1,aborted:!1,abort(){o.aborted=!0}},i=s.calculateDelay||W;async function r(){if(s.beforeAttempt&&s.beforeAttempt(o,s),o.aborted){let e=Error("Attempt aborted");throw e.code="ATTEMPT_ABORTED",e}let t=async e=>{if(s.handleError&&await s.handleError(e,o,s),o.aborted||0===o.attemptsRemaining)throw e;o.attemptNum++;let t=i(o,s);return t&&await G(t),r()};return(o.attemptsRemaining>0&&o.attemptsRemaining--,s.timeout)?new Promise((n,i)=>{let r=setTimeout(()=>{if(s.handleTimeout)try{n(s.handleTimeout(o,s))}catch(e){i(e)}else{let e=Error(`Retry timeout (attemptNum: ${o.attemptNum}, timeout: ${s.timeout})`);e.code="ATTEMPT_TIMEOUT",i(e)}},s.timeout);e(o,s).then(e=>{clearTimeout(r),n(e)}).catch(e=>{clearTimeout(r),t(e).then(n).catch(i)})}):e(o,s).catch(t)}let a=s.calculateDelay?s.calculateDelay(o,s):s.initialDelay;return a&&await G(a),r()}var Y=n(39907),q=n(1048).hp;let J=()=>new Map,Q=(e,t,n)=>{let s=e.get(t);return void 0===s&&e.set(t,s=n()),s},Z=()=>new Set,K=Array.from,X=String.fromCharCode,ee=e=>e.toLowerCase(),et=/^\s*/g,en=e=>e.replace(et,""),es=/([A-Z])/g,eo=(e,t)=>en(e.replace(es,e=>`${t}${ee(e)}`)),ei="undefined"!=typeof TextEncoder?new TextEncoder:null,er=ei?e=>ei.encode(e):e=>{let t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let e=0;e<n;e++)s[e]=t.codePointAt(e);return s},ea="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ea&&1===ea.decode(new Uint8Array).length&&(ea=null);let ec=e=>void 0===e?null:e;class el{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let ed=new el,eu=!0;try{"undefined"!=typeof localStorage&&localStorage&&(ed=localStorage,eu=!1)}catch(e){}let eh=ed,ep=e=>eu||addEventListener("storage",e),eg=e=>eu||removeEventListener("storage",e),ef=Object.keys,em=(e,t)=>{let n=[];for(let s in e)n.push(t(e[s],s));return n},ey=e=>ef(e).length,eb=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),ew=(e,t)=>e===t,ev=(e,t)=>{if(null==e||null==t)return ew(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!ev(e.get(n),t.get(n)))return!1;break;case Object:if(ey(e)!==ey(t))return!1;for(let n in e)if(!eb(e,n)||!ev(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!ev(e[n],t[n]))return!1;break;default:return!1}return!0},eS=void 0!==Y&&Y.release&&/node|io\.js/.test(Y.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==Y?Y:0),eA="undefined"!=typeof window&&"undefined"!=typeof document&&!eS;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let eC=()=>{if(void 0===s){if(eS){s=J();let e=Y.argv,t=null;for(let n=0;n<e.length;n++){let o=e[n];"-"===o[0]?(null!==t&&s.set(t,""),t=o):null!==t&&(s.set(t,o),t=null)}null!==t&&s.set(t,"")}else"object"==typeof location?(s=J(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){let[t,n]=e.split("=");s.set(`--${eo(t,"-")}`,n),s.set(`-${eo(t,"-")}`,n)}})):s=J()}return s},ex=e=>eC().has(e),ek=e=>eS?ec(Y.env[e.toUpperCase()]):ec(eh.getItem(e));(e=>ex("--"+e)||ek(e))("production");let eE=eS&&["true","1","2"].includes(Y.env.FORCE_COLOR);!ex("no-colors")&&(!eS||Y.stdout.isTTY||eE)&&(!eS||ex("color")||eE||null!==ek("COLORTERM")||(ek("TERM")||"").includes("color"));let eT=Math.floor,eP=(e,t)=>e<t?e:t,eD=(e,t)=>e>t?e:t,eM=Number.MAX_SAFE_INTEGER;class eO{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let eI=()=>new eO,e_=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},eR=e=>{let t=new Uint8Array(e_(e)),n=0;for(let s=0;s<e.bufs.length;s++){let o=e.bufs[s];t.set(o,n),n+=o.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},eN=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},eU=(e,t)=>{for(;t>127;)eN(e,128|127&t),t=eT(t/128);eN(e,127&t)},eL=new Uint8Array(3e4),ej=eL.length/3,ez=ei&&ei.encodeInto?(e,t)=>{if(t.length<ej){let n=ei.encodeInto(t,eL).written||0;eU(e,n);for(let t=0;t<n;t++)eN(e,eL[t])}else eF(e,er(t))}:(e,t)=>{let n=unescape(encodeURIComponent(t)),s=n.length;eU(e,s);for(let t=0;t<s;t++)eN(e,n.codePointAt(t))},eH=(e,t)=>{let n=e.cbuf.length,s=e.cpos,o=eP(n-s,t.length),i=t.length-o;e.cbuf.set(t.subarray(0,o),s),e.cpos+=o,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(eD(2*n,i)),e.cbuf.set(t.subarray(o)),e.cpos=i)},eF=(e,t)=>{eU(e,t.byteLength),eH(e,t)},eB=e=>Error(e),eV=eB("Unexpected end of array"),eG=eB("Integer out of Range");class eW{constructor(e){this.arr=e,this.pos=0}}let e$=e=>new eW(e),eY=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},eq=e=>eY(e,eQ(e)),eJ=e=>e.arr[e.pos++],eQ=e=>{let t=0,n=1,s=e.arr.length;for(;e.pos<s;){let s=e.arr[e.pos++];if(t+=(127&s)*n,n*=128,s<128)return t;if(t>eM)throw eG}throw eV},eZ=e=>{let t=e.arr[e.pos++],n=63&t,s=64,o=(64&t)>0?-1:1;if((128&t)==0)return o*n;let i=e.arr.length;for(;e.pos<i;){if(n+=(127&(t=e.arr[e.pos++]))*s,s*=128,t<128)return o*n;if(n>eM)throw eG}throw eV},eK=ea?e=>ea.decode(eq(e)):e=>{let t=eQ(e);if(0===t)return"";{let n=String.fromCodePoint(eJ(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(eJ(e));else for(;t>0;){let s=t<1e4?t:1e4,o=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,o),t-=s}return decodeURIComponent(escape(n))}},eX=e=>{let t=e.pos,n=eK(e);return e.pos=t,n},e0=e=>new Uint8Array(e),e1=(e,t,n)=>new Uint8Array(e,t,n),e2=e=>new Uint8Array(e),e3=eA?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=X(e[n]);return btoa(t)}:e=>q.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),e8=eA?e=>{let t=atob(e),n=e0(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{let t=q.from(e,"base64");return e1(t.buffer,t.byteOffset,t.byteLength)},e5=new Map;class e4{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:e8(t.newValue||"")}),ep(this._onChange)}postMessage(e){eh.setItem(this.room,e3(e2(e)))}close(){eg(this._onChange)}}let e7="undefined"==typeof BroadcastChannel?e4:BroadcastChannel,e6=e=>Q(e5,e,()=>{let t=Z(),n=new e7(e);return n.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:n,subs:t}}),e9=(e,t)=>(e6(e).subs.add(t),t),te=(e,t)=>{let n=e6(e),s=n.subs.delete(t);return s&&0===n.subs.size&&(n.bc.close(),e5.delete(e)),s},tt=(e,t,n=null)=>{let s=e6(e);s.bc.postMessage(t),s.subs.forEach(e=>e(t,n))},tn=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==n&&n()}},ts=Date.now;class to{constructor(){this._observers=J()}on(e,t){Q(this._observers,e,Z).add(t)}once(e,t){let n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){let n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return K((this._observers.get(e)||J()).values()).forEach(e=>e(...t))}destroy(){this._observers=J()}}class ti extends to{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let e=ts();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let t=[];this.meta.forEach((n,s)=>{s!==this.clientID&&3e4<=e-n.lastUpdated&&this.states.has(s)&&t.push(s)}),t.length>0&&tr(this,t,"timeout")},eT(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,n=this.meta.get(t),s=void 0===n?0:n.clock+1,o=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:ts()});let i=[],r=[],a=[],c=[];null===e?c.push(t):null==o?null!=e&&i.push(t):(r.push(t),ev(o,e)||a.push(t)),(i.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:i,updated:a,removed:c},"local"]),this.emit("update",[{added:i,updated:r,removed:c},"local"])}setLocalStateField(e,t){let n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}let tr=(e,t,n)=>{let s=[];for(let n=0;n<t.length;n++){let o=t[n];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){let t=e.meta.get(o);e.meta.set(o,{clock:t.clock+1,lastUpdated:ts()})}s.push(o)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},n]),e.emit("update",[{added:[],updated:[],removed:s},n]))},ta=(e,t,n=e.states)=>{let s=t.length,o=eI();eU(o,s);for(let i=0;i<s;i++){let s=t[i],r=n.get(s)||null,a=e.meta.get(s).clock;eU(o,s),eU(o,a),ez(o,JSON.stringify(r))}return eR(o)},tc=(e,t,n)=>{let s=e$(t),o=ts(),i=[],r=[],a=[],c=[],l=eQ(s);for(let t=0;t<l;t++){let t=eQ(s),n=eQ(s),l=JSON.parse(eK(s)),d=e.meta.get(t),u=e.states.get(t),h=void 0===d?0:d.clock;(h<n||h===n&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:n,lastUpdated:o}),void 0===d&&null!==l?i.push(t):void 0!==d&&null===l?c.push(t):null!==l&&(ev(l,u)||a.push(t),r.push(t)))}(i.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:i,updated:a,removed:c},n]),(i.length>0||r.length>0||c.length>0)&&e.emit("update",[{added:i,updated:r,removed:c},n])};class tl{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){let n=this.callbacks[e];return n&&n.forEach(e=>e.apply(this,t)),this}off(e,t){let n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter(e=>e!==t):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}let td=e=>em(e,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");!function(e){e[e.Sync=0]="Sync",e[e.Awareness=1]="Awareness",e[e.Auth=2]="Auth",e[e.QueryAwareness=3]="QueryAwareness",e[e.Stateless=5]="Stateless",e[e.CLOSE=7]="CLOSE",e[e.SyncStatus=8]="SyncStatus"}(r||(r={})),function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnected="disconnected"}(a||(a={}));class tu{constructor(e){this.data=e,this.encoder=eI(),this.decoder=e$(new Uint8Array(this.data))}peekVarString(){return eX(this.decoder)}readVarUint(){return eQ(this.decoder)}readVarString(){return eK(this.decoder)}readVarUint8Array(){return eq(this.decoder)}writeVarUint(e){return eU(this.encoder,e)}writeVarString(e){return ez(this.encoder,e)}writeVarUint8Array(e){return eF(this.encoder,e)}length(){return e_(this.encoder)}}class th extends tl{constructor(e){if(super(),this.messageQueue=[],this.configuration={url:"",document:void 0,WebSocketPolyfill:void 0,parameters:{},connect:!0,broadcast:!0,forceSyncInterval:!1,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,quiet:!1,providerMap:new Map},this.webSocket=null,this.webSocketHandlers={},this.shouldConnect=!0,this.status=a.Disconnected,this.lastMessageReceived=0,this.identifier=0,this.intervals={forceSync:null,connectionChecker:null},this.connectionAttempt=null,this.receivedOnOpenPayload=void 0,this.receivedOnStatusPayload=void 0,this.closeTries=0,this.setConfiguration(e),this.configuration.WebSocketPolyfill=e.WebSocketPolyfill?e.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("open",this.onOpen.bind(this)),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("status",this.configuration.onStatus),this.on("status",this.onStatus.bind(this)),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("close",this.onClose.bind(this)),this.on("message",this.onMessage.bind(this)),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),void 0!==e.connect&&(this.shouldConnect=e.connect),!this.shouldConnect)return;this.connect()}async onOpen(e){this.receivedOnOpenPayload=e}async onStatus(e){this.receivedOnStatusPayload=e}attach(e){let t;return this.configuration.providerMap.set(e.configuration.name,e),this.status===a.Disconnected&&this.shouldConnect&&(t=this.connect()),this.receivedOnOpenPayload&&e.onOpen(this.receivedOnOpenPayload),this.receivedOnStatusPayload&&e.onStatus(this.receivedOnStatusPayload),t}detach(e){this.configuration.providerMap.delete(e.configuration.name)}setConfiguration(e={}){this.configuration={...this.configuration,...e}}async connect(){if(this.status===a.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.receivedOnOpenPayload=void 0,this.receivedOnStatusPayload=void 0,this.shouldConnect=!0;let{retryPromise:e,cancelFunc:t}=(()=>{let e=!1;return{retryPromise:$(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:t=>{(!this.shouldConnect||e)&&t.abort()}}).catch(e=>{if(e&&"ATTEMPT_ABORTED"!==e.code)throw e}),cancelFunc:()=>{e=!0}}})();return this.cancelWebsocketRetry=t,e}attachWebSocketListeners(e,t){let{identifier:n}=e;this.webSocketHandlers[n]={message:e=>this.emit("message",e),close:e=>this.emit("close",{event:e}),open:e=>this.emit("open",e),error:e=>{t(e)}};let s=this.webSocketHandlers[e.identifier];Object.keys(s).forEach(t=>{e.addEventListener(t,s[t])})}cleanupWebSocket(){if(!this.webSocket)return;let{identifier:e}=this.webSocket,t=this.webSocketHandlers[e];Object.keys(t).forEach(n=>{var s;null===(s=this.webSocket)||void 0===s||s.removeEventListener(n,t[n]),delete this.webSocketHandlers[e]}),this.webSocket.close(),this.webSocket=null}createWebSocketConnection(){return new Promise((e,t)=>{this.webSocket&&(this.messageQueue=[],this.cleanupWebSocket()),this.lastMessageReceived=0,this.identifier+=1;let n=new this.configuration.WebSocketPolyfill(this.url);n.binaryType="arraybuffer",n.identifier=this.identifier,this.attachWebSocketListeners(n,t),this.webSocket=n,this.status=a.Connecting,this.emit("status",{status:a.Connecting}),this.connectionAttempt={resolve:e,reject:t}})}onMessage(e){var t;this.resolveConnectionAttempt(),this.lastMessageReceived=ts();let n=new tu(e.data).peekVarString();null===(t=this.configuration.providerMap.get(n))||void 0===t||t.onMessage(e)}resolveConnectionAttempt(){this.connectionAttempt&&(this.connectionAttempt.resolve(),this.connectionAttempt=null,this.status=a.Connected,this.emit("status",{status:a.Connected}),this.emit("connect"),this.messageQueue.forEach(e=>this.send(e)),this.messageQueue=[])}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var e;null===(e=this.connectionAttempt)||void 0===e||e.reject(),this.connectionAttempt=null}checkConnection(){var e;this.status!==a.Connected||!this.lastMessageReceived||this.configuration.messageReconnectTimeout>=ts()-this.lastMessageReceived||(this.closeTries+=1,this.closeTries>2?(this.onClose({event:{code:4408,reason:"forced"}}),this.closeTries=0):(null===(e=this.webSocket)||void 0===e||e.close(),this.messageQueue=[]))}get serverUrl(){for(;"/"===this.configuration.url[this.configuration.url.length-1];)return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){let e=td(this.configuration.parameters);return`${this.serverUrl}${0===e.length?"":`?${e}`}`}disconnect(){if(this.shouldConnect=!1,null!==this.webSocket)try{this.webSocket.close(),this.messageQueue=[]}catch{}}send(e){var t;(null===(t=this.webSocket)||void 0===t?void 0:t.readyState)===i.Open?this.webSocket.send(e):this.messageQueue.push(e)}onClose({event:e}){if(this.closeTries=0,this.cleanupWebSocket(),this.status===a.Connected&&(this.status=a.Disconnected,this.emit("status",{status:a.Disconnected}),this.emit("disconnect",{event:e})),e.code===H.code&&(e.reason===H.reason?console.warn("[HocuspocusProvider] An authentication token is required, but you didn’t send one. Try adding a `token` to your HocuspocusProvider configuration. Won’t try again."):console.warn(`[HocuspocusProvider] Connection closed with status Unauthorized: ${e.reason}`),this.shouldConnect=!1),e.code===F.code&&!this.configuration.quiet){console.warn("[HocuspocusProvider] The provided authentication token isn’t allowed to connect to this server. Will try again.");return}e.code===z.code&&(console.warn(`[HocuspocusProvider] Connection closed with status MessageTooBig: ${e.reason}`),this.shouldConnect=!1),this.connectionAttempt?this.rejectConnectionAttempt():this.shouldConnect&&this.connect(),this.shouldConnect||this.status===a.Disconnected||(this.status=a.Disconnected,this.emit("status",{status:a.Disconnected}),this.emit("disconnect",{event:e}))}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),clearInterval(this.intervals.connectionChecker),this.stopConnectionAttempt(),this.disconnect(),this.removeAllListeners(),this.cleanupWebSocket()}}let tp=(e,t)=>{eU(e,0),eF(e,V.FX(t))},tg=(e,t,n)=>{eU(e,1),eF(e,V.PR(t,n))},tf=(e,t,n)=>tg(t,n,eq(e)),tm=(e,t,n)=>{try{V.QE(t,eq(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},ty=(e,t)=>{eU(e,2),eF(e,t)},tb=(e,t,n,s)=>{let o=eQ(e);switch(o){case 0:tf(e,t,n);break;case 1:case 2:tm(e,n,s);break;default:throw Error("Unknown message type")}return o};class tw{constructor(){this.encoder=eI()}get(e){return e.encoder}toUint8Array(){return eR(this.encoder)}}class tv{constructor(e){this.broadcasted=!1,this.message=e}setBroadcasted(e){return this.broadcasted=e,this}apply(e,t){let{message:n}=this,s=n.readVarUint(),o=n.length();switch(s){case r.Sync:this.applySyncMessage(e,t);break;case r.Awareness:this.applyAwarenessMessage(e);break;case r.Auth:this.applyAuthMessage(e);break;case r.QueryAwareness:this.applyQueryAwarenessMessage(e);break;case r.Stateless:e.receiveStateless(eK(n.decoder));break;case r.SyncStatus:this.applySyncStatusMessage(e,1===eZ(n.decoder));break;default:throw Error(`Can’t apply message of unknown type: ${s}`)}n.length()>o+1&&(this.broadcasted?e.broadcast(tw,{encoder:n.encoder}):e.send(tw,{encoder:n.encoder}))}applySyncMessage(e,t){let{message:n}=this;n.writeVarUint(r.Sync);let s=tb(n.decoder,n.encoder,e.document,e);t&&1===s&&(e.synced=!0)}applySyncStatusMessage(e,t){t&&e.decrementUnsyncedChanges()}applyAwarenessMessage(e){if(!e.awareness)return;let{message:t}=this;tc(e.awareness,t.readVarUint8Array(),e)}applyAuthMessage(e){let{message:t}=this;j(t.decoder,e.permissionDeniedHandler.bind(e),e.authenticatedHandler.bind(e))}applyQueryAwarenessMessage(e){if(!e.awareness)return;let{message:t}=this;t.writeVarUint(r.Awareness),t.writeVarUint8Array(ta(e.awareness,Array.from(e.awareness.getStates().keys())))}}class tS{constructor(e,t={}){this.message=new e,this.encoder=this.message.get(t)}create(){return eR(this.encoder)}send(e){null==e||e.send(this.create())}broadcast(e){tt(e,this.create())}}class tA extends tw{constructor(){super(...arguments),this.type=r.Auth,this.description="Authentication"}get(e){if(void 0===e.token)throw Error("The authentication message requires `token` as an argument.");return ez(this.encoder,e.documentName),eU(this.encoder,this.type),L(this.encoder,e.token),this.encoder}}class tC extends tw{constructor(){super(...arguments),this.type=r.Awareness,this.description="Awareness states update"}get(e){let t;if(void 0===e.awareness)throw Error("The awareness message requires awareness as an argument");if(void 0===e.clients)throw Error("The awareness message requires clients as an argument");return ez(this.encoder,e.documentName),eU(this.encoder,this.type),t=void 0===e.states?ta(e.awareness,e.clients):ta(e.awareness,e.clients,e.states),eF(this.encoder,t),this.encoder}}class tx extends tw{constructor(){super(...arguments),this.type=r.CLOSE,this.description="Ask the server to close the connection"}get(e){return ez(this.encoder,e.documentName),eU(this.encoder,this.type),this.encoder}}class tk extends tw{constructor(){super(...arguments),this.type=r.QueryAwareness,this.description="Queries awareness states"}get(e){return ez(this.encoder,e.documentName),eU(this.encoder,this.type),this.encoder}}class tE extends tw{constructor(){super(...arguments),this.type=r.Stateless,this.description="A stateless message"}get(e){var t;return ez(this.encoder,e.documentName),eU(this.encoder,this.type),ez(this.encoder,null!==(t=e.payload)&&void 0!==t?t:""),this.encoder}}class tT extends tw{constructor(){super(...arguments),this.type=r.Sync,this.description="First sync step"}get(e){if(void 0===e.document)throw Error("The sync step one message requires document as an argument");return ez(this.encoder,e.documentName),eU(this.encoder,this.type),tp(this.encoder,e.document),this.encoder}}class tP extends tw{constructor(){super(...arguments),this.type=r.Sync,this.description="Second sync step"}get(e){if(void 0===e.document)throw Error("The sync step two message requires document as an argument");return ez(this.encoder,e.documentName),eU(this.encoder,this.type),tg(this.encoder,e.document),this.encoder}}class tD extends tw{constructor(){super(...arguments),this.type=r.Sync,this.description="A document update"}get(e){return ez(this.encoder,e.documentName),eU(this.encoder,this.type),ty(this.encoder,e.update),this.encoder}}class tM extends Error{constructor(){super(...arguments),this.code=1001}}class tO extends tl{constructor(e){var t,n,s;super(),this.configuration={name:"",document:void 0,awareness:void 0,token:null,parameters:{},broadcast:!0,forceSyncInterval:!1,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,quiet:!1,connect:!0,preserveConnection:!0},this.subscribedToBroadcastChannel=!1,this.isSynced=!1,this.unsyncedChanges=0,this.status=a.Disconnected,this.isAuthenticated=!1,this.authorizedScope=void 0,this.mux=tn(),this.intervals={forceSync:null},this.isConnected=!0,this.boundDocumentUpdateHandler=this.documentUpdateHandler.bind(this),this.boundAwarenessUpdateHandler=this.awarenessUpdateHandler.bind(this),this.boundBroadcastChannelSubscriber=this.broadcastChannelSubscriber.bind(this),this.boundPageHide=this.pageHide.bind(this),this.boundOnOpen=this.onOpen.bind(this),this.boundOnClose=this.onClose.bind(this),this.boundOnStatus=this.onStatus.bind(this),this.forwardConnect=e=>this.emit("connect",e),this.forwardOpen=e=>this.emit("open",e),this.forwardClose=e=>this.emit("close",e),this.forwardDisconnect=e=>this.emit("disconnect",e),this.forwardDestroy=e=>this.emit("destroy",e),this.setConfiguration(e),this.configuration.document=e.document?e.document:new V.JA,this.configuration.awareness=void 0!==e.awareness?e.awareness:new ti(this.document),this.on("open",this.configuration.onOpen),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),this.configuration.websocketProvider.on("connect",this.configuration.onConnect),this.configuration.websocketProvider.on("connect",this.forwardConnect),this.configuration.websocketProvider.on("open",this.boundOnOpen),this.configuration.websocketProvider.on("open",this.forwardOpen),this.configuration.websocketProvider.on("close",this.boundOnClose),this.configuration.websocketProvider.on("close",this.configuration.onClose),this.configuration.websocketProvider.on("close",this.forwardClose),this.configuration.websocketProvider.on("status",this.boundOnStatus),this.configuration.websocketProvider.on("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.on("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.on("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.on("destroy",this.forwardDestroy),null===(t=this.awareness)||void 0===t||t.on("update",()=>{this.emit("awarenessUpdate",{states:B(this.awareness.getStates())})}),null===(n=this.awareness)||void 0===n||n.on("change",()=>{this.emit("awarenessChange",{states:B(this.awareness.getStates())})}),this.document.on("update",this.boundDocumentUpdateHandler),null===(s=this.awareness)||void 0===s||s.on("update",this.boundAwarenessUpdateHandler),this.registerEventListeners(),this.configuration.forceSyncInterval&&"number"==typeof this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),this.configuration.websocketProvider.attach(this)}onStatus({status:e}){this.status=e,this.configuration.onStatus({status:e}),this.emit("status",{status:e})}setConfiguration(e={}){!e.websocketProvider&&e.url&&(this.configuration.websocketProvider=new th({url:e.url,connect:e.connect,parameters:e.parameters})),this.configuration={...this.configuration,...e}}get document(){return this.configuration.document}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}resetUnsyncedChanges(){this.unsyncedChanges=1,this.emit("unsyncedChanges",this.unsyncedChanges)}incrementUnsyncedChanges(){this.unsyncedChanges+=1,this.emit("unsyncedChanges",this.unsyncedChanges)}decrementUnsyncedChanges(){this.unsyncedChanges-=1,0===this.unsyncedChanges&&(this.synced=!0),this.emit("unsyncedChanges",this.unsyncedChanges)}forceSync(){this.resetUnsyncedChanges(),this.send(tT,{document:this.document,documentName:this.configuration.name})}pageHide(){this.awareness&&tr(this.awareness,[this.document.clientID],"page hide")}registerEventListeners(){"undefined"!=typeof window&&"addEventListener"in window&&window.addEventListener("pagehide",this.boundPageHide)}sendStateless(e){this.send(tE,{documentName:this.configuration.name,payload:e})}documentUpdateHandler(e,t){t!==this&&(this.incrementUnsyncedChanges(),this.send(tD,{update:e,documentName:this.configuration.name},!0))}awarenessUpdateHandler({added:e,updated:t,removed:n},s){let o=e.concat(t).concat(n);this.send(tC,{awareness:this.awareness,clients:o,documentName:this.configuration.name},!0)}get synced(){return this.isSynced}set synced(e){this.isSynced!==e&&(this.isSynced=e,this.emit("synced",{state:e}),this.emit("sync",{state:e}))}receiveStateless(e){this.emit("stateless",{payload:e})}get isAuthenticationRequired(){return!!this.configuration.token&&!this.isAuthenticated}async connect(){return this.configuration.broadcast&&this.subscribeToBroadcastChannel(),this.configuration.websocketProvider.shouldConnect=!0,this.configuration.websocketProvider.attach(this)}disconnect(){this.disconnectBroadcastChannel(),this.configuration.websocketProvider.detach(this),this.isConnected=!1,this.configuration.preserveConnection||this.configuration.websocketProvider.disconnect()}async onOpen(e){let t;this.isAuthenticated=!1,this.isConnected=!0,this.emit("open",{event:e});try{t=await this.getToken()}catch(e){this.permissionDeniedHandler(`Failed to get token: ${e}`);return}this.isAuthenticationRequired&&this.send(tA,{token:t,documentName:this.configuration.name}),this.startSync()}async getToken(){return"function"==typeof this.configuration.token?await this.configuration.token():this.configuration.token}startSync(){this.resetUnsyncedChanges(),this.send(tT,{document:this.document,documentName:this.configuration.name}),this.awareness&&null!==this.awareness.getLocalState()&&this.send(tC,{awareness:this.awareness,clients:[this.document.clientID],documentName:this.configuration.name})}send(e,t,n=!1){if(!this.isConnected)return;n&&this.mux(()=>{this.broadcast(e,t)});let s=new tS(e,t);this.emit("outgoingMessage",{message:s.message}),s.send(this.configuration.websocketProvider)}onMessage(e){let t=new tu(e.data),n=t.readVarString();t.writeVarString(n),this.emit("message",{event:e,message:new tu(e.data)}),new tv(t).apply(this,!0)}onClose(e){this.isAuthenticated=!1,this.synced=!1,this.awareness&&tr(this.awareness,Array.from(this.awareness.getStates().keys()).filter(e=>e!==this.document.clientID),this)}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),this.awareness&&(tr(this.awareness,[this.document.clientID],"provider destroy"),this.awareness.off("update",this.boundAwarenessUpdateHandler),this.awareness.destroy()),this.document.off("update",this.boundDocumentUpdateHandler),this.removeAllListeners(),this.configuration.websocketProvider.off("connect",this.configuration.onConnect),this.configuration.websocketProvider.off("connect",this.forwardConnect),this.configuration.websocketProvider.off("open",this.boundOnOpen),this.configuration.websocketProvider.off("open",this.forwardOpen),this.configuration.websocketProvider.off("close",this.boundOnClose),this.configuration.websocketProvider.off("close",this.configuration.onClose),this.configuration.websocketProvider.off("close",this.forwardClose),this.configuration.websocketProvider.off("status",this.boundOnStatus),this.configuration.websocketProvider.off("disconnect",this.configuration.onDisconnect),this.configuration.websocketProvider.off("disconnect",this.forwardDisconnect),this.configuration.websocketProvider.off("destroy",this.configuration.onDestroy),this.configuration.websocketProvider.off("destroy",this.forwardDestroy),this.send(tx,{documentName:this.configuration.name}),this.disconnect(),"undefined"!=typeof window&&"removeEventListener"in window&&window.removeEventListener("pagehide",this.boundPageHide)}permissionDeniedHandler(e){this.emit("authenticationFailed",{reason:e}),this.isAuthenticated=!1,this.disconnect(),this.status=a.Disconnected}authenticatedHandler(e){this.isAuthenticated=!0,this.authorizedScope=e,this.emit("authenticated")}get broadcastChannel(){return`${this.configuration.name}`}broadcastChannelSubscriber(e){this.mux(()=>{let t=new tu(e),n=t.readVarString();t.writeVarString(n),new tv(t).setBroadcasted(!0).apply(this,!1)})}subscribeToBroadcastChannel(){this.subscribedToBroadcastChannel||(e9(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!0),this.mux(()=>{this.broadcast(tT,{document:this.document,documentName:this.configuration.name}),this.broadcast(tP,{document:this.document,documentName:this.configuration.name}),this.broadcast(tk,{document:this.document,documentName:this.configuration.name}),this.awareness&&this.broadcast(tC,{awareness:this.awareness,clients:[this.document.clientID],document:this.document,documentName:this.configuration.name})})}disconnectBroadcastChannel(){this.awareness&&this.send(tC,{awareness:this.awareness,clients:[this.document.clientID],states:new Map,documentName:this.configuration.name},!0),this.subscribedToBroadcastChannel&&(te(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!1)}broadcast(e,t){this.configuration.broadcast&&this.subscribedToBroadcastChannel&&new tS(e,t).broadcast(this.broadcastChannel)}setAwarenessField(e,t){if(!this.awareness)throw new tM(`Cannot set awareness field "${e}" to ${JSON.stringify(t)}. You have disabled Awareness for this provider by explicitly passing awareness: null in the provider configuration.`);this.awareness.setLocalStateField(e,t)}}crypto.getRandomValues.bind(crypto);var tI=n(85194),t_=n(14041),tR=n(54268),tN=n(73893),tU=n(74240),tL=n(91559),tj=n(49880),tz=n(35002),tH=n(33854),tF=n(13040),tB=n(59025),tV=n(64225),tG=n(87747),tW=n(88203),t$=n(57882),tY=n(47014),tq=n(4588),tJ=n(9335),tQ=n(77159),tZ=n(9568),tK=n(28302),tX=n(13236),t0=n(81570),t1=n(29097),t2=n(7908),t3=n(9952),t8=n(27617),t5=n(60443);let t4=e=>e.pos+e.node.nodeSize-1,t7=e=>{let{selection:t}=e,n=t.$head||t.$anchor,s=(0,tX.eL)(n,e=>"paragraph"===e.type.name||(0,t5.x)(e));return s&&s.node.content.size?s:null},t6=e=>{let{view:t,state:n,isFlagEnabled:s,editor:o}=e;if(!s)return null;let{selection:i}=n,{empty:r}=i,a=t8.n.getState(n),c=t7(n),l=null==a?void 0:a.loading;return t.hasFocus()&&r&&c&&o.isEditable&&!l?c:null};class t9{initialize(e){let{buttonElement:t,tippyTarget:n}=e;if(this.isFlagEnabled){if(!t||!n){console.warn("[AutocompleteButtonView] initialize. No element provided");return}this.element=t,this.target=n,this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.createTooltip(),this.element.style.visibility="visible"}}createTooltip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!this.isFlagEnabled)return;let n=t||this.view.dom.parentElement;n&&this.element&&(this.tippy=(0,t1.Ay)(n,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...e}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){if(!this.isFlagEnabled)return;let{state:n,composing:s}=e,{doc:o,selection:i}=n,r=t&&t3.f.getState(t),a=t3.f.getState(e.state),c=t&&t.doc.eq(o)&&t.selection.eq(i)&&this.isEditable===this.editor.isEditable&&(null==r?void 0:r.forceHide)===a.forceHide;if(!this.element||!this.target){if(!a.buttonElement||!a.tippyTarget)return;this.initialize(a)}let l=!(null==t?void 0:t.selection.eq(i)),d=!(null==t?void 0:t.doc.eq(o));if(this.isEditable=this.editor.isEditable,!this.editor.isEditable||!0===a.forceHide){this.hide();return}if(!s&&!c){if(l&&!d){if(!this.shouldShow({view:e,state:n})){this.hide();return}this.show()}else d&&(this.hide(),this.typingTimeout&&clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout(()=>{this.editor&&this.view.hasFocus()&&this.shouldShow({view:e,state:this.editor.state})&&this.show()},750))}}show(){var e,t;if(!this.isFlagEnabled||!this.validParentNode||(this.nodeEndPos=t4(this.validParentNode),!this.nodeEndPos))return;let n=(0,t2.KQ)(this.validParentNode.node);null===(e=this.tippy)||void 0===e||e.setProps({getReferenceClientRect:()=>(0,tX.MG)(this.editor.view,this.nodeEndPos||0,this.nodeEndPos||0),placement:"rtl"===n?"left":"right"}),this.element&&(this.element.textContent="rtl"===n?"←":"→"),null===(t=this.tippy)||void 0===t||t.show()}hide(){var e;this.isFlagEnabled&&(this.onHide&&"function"==typeof this.onHide&&this.onHide(),null===(e=this.tippy)||void 0===e||e.hide())}destroy(){var e,t,n;this.isFlagEnabled&&(this.typingTimeout&&clearTimeout(this.typingTimeout),(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),null===(n=this.element)||void 0===n||n.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler),this.cleanupPanelLifecycle&&this.cleanupPanelLifecycle())}constructor({editor:e,view:t}){this.element=null,this.target=null,this.preventHide=!1,this.typingTimeout=null,this.validParentNode=null,this.nodeEndPos=null,this.onHide=()=>{},this.mousedownHandler=()=>{this.nodeEndPos&&this.isFlagEnabled&&(this.preventHide=!0,this.editor.commands.setTextSelection(this.nodeEndPos),setTimeout(()=>{this.editor.commands.autoComplete(),this.hide()}))},this.focusHandler=()=>{setTimeout(()=>this.update(this.view))},this.blurHandler=e=>{var t,n;let{event:s}=e;if(this.preventHide){this.preventHide=!1;return}(null==s?void 0:s.relatedTarget)&&(null===(n=this.element)||void 0===n?void 0:null===(t=n.parentNode)||void 0===t?void 0:t.contains(s.relatedTarget))||(null==s?void 0:s.relatedTarget)===this.editor.view.dom||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.shouldShow=e=>{let{view:t,state:n}=e;return!!this.isFlagEnabled&&(this.validParentNode=t6({view:t,state:n,isFlagEnabled:this.isFlagEnabled,editor:this.editor}),!!this.validParentNode)},this.isFlagEnabled=tz.of.get("arrowAutocomplete"),this.editor=e,this.view=t,this.isEditable=e.isEditable}}let ne=tX.YY.create({name:"autocompleteButton",addCommands:()=>({forceHideAutocompleteButton:e=>t=>{let{tr:n}=t;return n.setMeta(t3.f,{forceHide:e}),!0}}),addProseMirrorPlugins(){let{editor:e}=this;return[new t0.k_({key:t3.f,state:{init:()=>({buttonElement:null,tippyTarget:null,forceHide:!1}),apply(e,t){let n=e.getMeta(t3.f);return n?{...t,...n}:t}},props:{handleKeyDown(t,n){var s,o;if("Tab"!==n.key||n.shiftKey)return!1;let{state:i}=t;return!!t6({view:t,state:i,isFlagEnabled:tz.of.get("arrowAutocomplete"),editor:e})&&(n.preventDefault(),e.commands.autoComplete(),null===(s=(o=e.commands).forceHideAutocompleteButton)||void 0===s||s.call(o,!0),!0)}},view:t=>new t9({view:t,editor:e})})]}});var nt=n(64761),nn=n(52743),ns=n(73547),no=n(96237),ni=n(6165),nr=n(23552),na=n(65056),nc=n(24502),nl=n(53478),nd=n(64972),nu=n(44984),nh=n(82451),np=n.n(nh),ng=n(1602),nf=n.n(ng),nm=n(77646);let ny=(e,t,n)=>{let s=e.resolve(t),o=e.resolve(n),i=s.nodeAfter,r=o.nodeBefore;return!!(i&&(0,nm.jg)(i)&&r&&(0,nm.jg)(r)&&i===r)};var nb=n(3583),nw=n(54107),nv=n(4266);let nS=(e,t,n)=>e!==t,nA=e=>{let t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.setAttribute("style","background-color: ".concat(e.color)),n.insertBefore(document.createTextNode(e.name),null);let s=document.createTextNode("⁠"),o=document.createTextNode("⁠");return t.insertBefore(s,null),t.insertBefore(n,null),t.insertBefore(o,null),t},nC=e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),nx=(e,t)=>(n,s,o,i)=>{let r=[];r.push(c.NZ.widget(i,()=>t(n),{key:s+"",side:10}));let a=nv.jk(o,i),l=nv.T9(o,i);return r.push(c.NZ.inline(a,l,e(n),{inclusiveEnd:!0,inclusiveStart:!1})),r},nk=/^#[0-9a-fA-F]{6}$/,nE=(e,t,n,s)=>{let o=nb.pJ.getState(e),i=o.doc,r=[];return null!=o.snapshot||null!=o.prevSnapshot||null===o.binding?c.zF.create(e.doc,[]):(t.getStates().forEach((t,a)=>{if(n(i.clientID,a,t)&&null!=t.cursor){let n=t.user||{};null==n.color?n.color="#ffa500":nk.test(n.color)||console.warn("A user uses an unsupported color format",n),null==n.name&&(n.name="User: ".concat(a));let c=(0,nw.bL)(i,o.type,V.sH(t.cursor.anchor),o.binding.mapping),l=(0,nw.bL)(i,o.type,V.sH(t.cursor.head),o.binding.mapping);if(null!==c&&null!==l){let t=nv.T9(e.doc.content.size-1,0);c=nv.jk(c,t),l=nv.jk(l,t),r.push(...s(e,n,a,c,l))}}}),c.zF.create(e.doc,r))},nT=function(e){let{awarenessStateFilter:t=nS,cursorBuilder:n=nA,selectionBuilder:s=nC,getSelection:o=e=>e.selection,createCursorDecorations:i=nx(s,n)}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cursor";return new t0.k_({key:nb.S6,state:{init:(n,s)=>nE(s,e,t,i),apply(n,s,o,r){let a=nb.pJ.getState(r),c=n.getMeta(nb.S6);return a&&a.isChangeOrigin||c&&c.awarenessUpdated?nE(r,e,t,i):s.map(n.mapping,n.doc)}},props:{decorations:e=>nb.S6.getState(e)},view:t=>{let n=()=>{t.docView&&(0,nw.iZ)(t,nb.S6,{awarenessUpdated:!0})},s=()=>{let n=nb.pJ.getState(t.state),s=e.getLocalState()||{};if(null!=n.binding){if(t.hasFocus()){let i=o(t.state),a=(0,nw.Bw)(i.anchor,n.type,n.binding.mapping),c=(0,nw.Bw)(i.head,n.type,n.binding.mapping);null!=s.cursor&&V.uG(V.sH(s.cursor.anchor),a)&&V.uG(V.sH(s.cursor.head),c)||e.setLocalStateField(r,{anchor:a,head:c})}else null!=s.cursor&&null!==(0,nw.bL)(n.doc,n.type,V.sH(s.cursor.anchor),n.binding.mapping)&&e.setLocalStateField(r,null)}};return e.on("change",n),t.dom.addEventListener("focusin",s),t.dom.addEventListener("focusout",s),{update:s,destroy:()=>{t.dom.removeEventListener("focusin",s),t.dom.removeEventListener("focusout",s),e.off("change",n),e.setLocalStateField(r,null)}}}})},nP=()=>null,nD=e=>Array.from(e.entries()).map(e=>{let[t,n]=e;return{clientId:t,...n.user}}),nM=tX.YY.create({name:"collaborationCursor",addOptions:()=>({provider:null,user:{name:null,color:null},render:e=>{let t=document.createElement("span");if(!e.isReady)return t;t.classList.add("collaboration-cursor__caret"),t.setAttribute("style","border-color: ".concat(e.color));let n=document.createElement("div");n.classList.add("collaboration-cursor__label"),n.setAttribute("style","background-color: ".concat(e.color,"; color: ").concat(nf()(e.color).isDark()?"white":"black"));let s=e.name.split(" ")[0];return n.insertBefore(document.createTextNode(s),null),t.insertBefore(n,null),t},buildSelection:e=>({style:"background-color: ".concat(e.color,"70"),class:"ProseMirror-yjs-selection"}),onUpdate:nP}),addStorage:()=>({users:[]}),addCommands(){return{user:e=>()=>(this.options.user=np()({},this.options.user,e),this.options.provider.awareness.setLocalStateField("user",this.options.user),!0)}},addProseMirrorPlugins(){return[nT((this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=nD(this.options.provider.awareness.states),this.options.provider.awareness.on("update",()=>{this.storage.users=nD(this.options.provider.awareness.states)}),this.options.provider.awareness),{createCursorDecorations:(e,t,n,s,o)=>{let i=[];if(ny(e.doc,s,o))return i;i.push(c.NZ.widget(o,()=>this.options.render(t),{key:n+"",side:10}));let r=s<o?s:o,a=s>o?s:o;return i.push(c.NZ.inline(r,a,this.options.buildSelection(t),{inclusiveEnd:!0,inclusiveStart:!1})),i}})]}});var nO=n(43873),nI=n(29316);let n_=tX.YY.create({name:"globalDragHandle",priority:nO.y.GlobalDragHandle,addOptions:()=>({scrollerSelector:"body"}),addStorage:()=>({enabled:!0}),addProseMirrorPlugins(){return[(0,nI.l)({editor:this.editor,storage:this.storage,scrollerSelector:this.options.scrollerSelector})]},extendNodeSchema(e){var t;return{containerHandle:null!==(t=(0,tX.gk)((0,tX.iI)(e,"containerHandle",e)))&&void 0!==t&&t}}});var nR=n(46291),nN=n(23672),nU=n(56154);let nL=new t0.hs("erasingContent");class nj{toJSON(){return{datetime:this.timestamp.toISOString(),meta:this.tr.meta,steps:this.tr.steps.map(e=>e.toJSON())}}constructor(e){this.tr=e,this.timestamp=new Date(new Date().toLocaleString("en-US",{timeZone:"America/Los_Angeles"}))}}class nz{apply(e,t){return e.docChanged&&(this.transactions.unshift(new nj(e)),this.transactions.length>5&&this.transactions.pop()),this}constructor(){this.transactions=[]}}class nH extends Error{constructor(e){super(e||"Content erased"),this.name="ContentErasedError"}}let nF=tX.YY.create({name:"ErasingContent",addProseMirrorPlugins(){let e=this,t=t=>{try{var n;let s=(0,t$.HW)();for(let t of this.options.messageLogger.flushMessages()){let n={...t.toDebugObject(),clientID:e.options.provider.document.clientID};nN.yf.logger.info(t.toString(),n),console.log(t.toString(),n)}let o=Math.floor(performance.now()-this.options.startTime),i={event:"CONTENT_ERASED",didFilterTransaction:t.didFilterTransaction,tr:t.tr.toJSON(),prevTrs:null===(n=t.prevTrs)||void 0===n?void 0:n.map(e=>e.toJSON()),timeSinceOpened:o,isBackgrounded:!!document.hidden,docId:this.options.provider.configuration.name,clientID:this.options.provider.document.clientID,userId:null==s?void 0:s.id};nN.yf.logger.error("[ErasingContent] ".concat(o," content erased (FILTERED: ").concat(t.didFilterTransaction,")"),i),nU.Cp(new nH)}catch(e){console.error("Failed to log content erased",e),nU.Cp(e)}};return[new t0.k_({key:nL,filterTransaction:(e,n)=>{if(!e.docChanged)return!0;let s=n.doc.type.createAndFill().content;if(null===e.doc.content.findDiffStart(s)){let s=new nj(e),o=nL.getState(n),i=tz.of.get("filterContentErasingTrs");return t({tr:s,didFilterTransaction:i,prevTrs:null==o?void 0:o.transactions}),!i}return!0},state:{init:()=>new nz,apply:(e,t,n,s)=>t.apply(e,s)}})]}});var nB=n(51183),nV=n(23463),nG=n(92091),nW=n(79893),n$=n(71837),nY=n(35873),nq=n(87643),nJ=n(73350),nQ=n(43167),nZ=n(5933),nK=n(55098),nX=n(40173),n0=n(25420),n1=n(27670),n2=n(56005),n3=n.n(n2),n8=n(45864);let n5=e=>{let{editor:t}=e,[n,s]=(0,t_.useState)(null);(0,t_.useEffect)(()=>{if(!t)return;let e=()=>{s(t.state.selection)};return e(),t.on("selectionUpdate",e),()=>{t.off("selectionUpdate",e)}},[t]);let o=n instanceof t0.nh,i=n instanceof n8.J,r=n3()((null==n?void 0:n.toJSON().type)||"none"),a=n3()(o&&(null==n?void 0:n.node.type.name)||""),c=i?void 0:o?"blue":"green";return(0,l.jsx)(nX.Z,{children:(0,l.jsx)(n0.s,{className:"selection-debugger",position:"absolute",top:"50px",left:"10px",zIndex:"999999",children:(0,l.jsxs)(h.B,{direction:"column",children:[(0,l.jsxs)(n1.E,{colorScheme:c,children:[r,a&&(0,l.jsxs)("i",{children:[" (",a,")"]})]}),n&&(0,l.jsxs)(n1.E,{colorScheme:"gray",children:["f:",n.from," - t:",n.to,i&&" | side:".concat(n.side)]})]})})})};var n4=n(12784),n7=n.n(n4),n6=n(99742),n9=n(32133),se=n(69086),st=n(14691);let sn=(0,n6.d_)("1234567890",10),ss=()=>{let e=se.e.getItem(st.E.sessionId);if(e)return e;let t="".concat(+new Date,"__").concat(sn());return se.e.setItem(st.E.sessionId,t),t},so=(e,t)=>{let{user:n,isUserLoading:s,anonymousUser:o,color:i}=(0,t$.ur)(),r=(0,t_.useRef)(!1),a=(0,n9.wA)(),c=(0,t_.useMemo)(()=>ss(),[]),l=(0,tV.GV)(nZ.l$),d=(0,t_.useMemo)(()=>({id:(null==n?void 0:n.id)||o.id,color:i.value,sessionId:l?c+"__pv":c,isPresenterView:l,idleSince:null,name:(null==n?void 0:n.displayName)||o.displayName||"",profileImageUrl:(null==n?void 0:n.profileImageUrl)||"",isReady:!s,spotlight:{pos:null,cardId:null}}),[n,i,s,l,o,c]);(0,t_.useEffect)(()=>{if(!e||e.isDestroyed||!(null==t?void 0:t.awareness))return;e.commands.user(d),!r.current&&d.isReady&&(e.chain().blur().focusDelayed().run(),r.current=!0),a((0,nZ.vK)({sessionId:d.sessionId}));let n=(e,n)=>{let{added:s,updated:o,removed:i}=e;requestIdleCallback(()=>{if(!t.awareness)return;let e=nD(t.awareness.states);a((0,nZ._)({collaborators:e}))},{timeout:500})};t.awareness.on("change",n);let s=n7()(n,nZ.Y5);return t.awareness.on("update",s),()=>{var e,o;null===(e=t.awareness)||void 0===e||e.off("change",n),null===(o=t.awareness)||void 0===o||o.off("update",s)}},[d,e,t,a]),(0,t_.useEffect)(()=>{if(!e)return;let t=n7()(t=>{e.commands.user(t)},10);return(0,tV.oM)(nZ.kM,t)},[e])};var si=n(20637),sr=n(38473),sa=n(70156),sc=n.n(sa),sl=n(30358);let sd=e=>JSON.stringify(Array.from(e.entries())),su=e=>JSON.stringify(Array.from(e)),sh=e=>Array.from(e.entries()),sp=e=>e instanceof V.q7?{__type:e.constructor.name,id:e.id,length:e.length,info:e.info,parent:e.parent,parentSub:e.parentSub,content:{__type:e.content.constructor.name,...e.content}}:e,sg=()=>{let e=(0,sr.xv)();return(0,sr.Qj)(e,""),(0,sr.zd)(e,r.Sync),(0,sr.zd)(e,1),(0,sr.Gu)(e,new Uint8Array([])),(0,sr.Fo)(e)};class sf{setTransaction(e){this.transaction=e}shouldAssociateTransaction(){return!1}getPayload(){return{}}toString(){let e="in"===this.dir?"\uD83D\uDFE9⬇️":"\uD83D\uDFE6⬆️",t=sc()(String(this.timestamp),5);return"".concat("[HocuspocusMessage]"," ").concat(t," ").concat(e," ").concat(this.typeName)}toDebugObject(){var e;return{event:"hocuspocus-message",docId:this.docId,userId:null===(e=(0,sl.HW)())||void 0===e?void 0:e.id,hocuspocusMessage:{dir:this.dir,timestamp:this.timestamp,typeName:this.typeName,messageType:this.messageType,payload:this.getPayload()}}}static fromOutgoingMessage(e,t){let n=0===e.encoder.cpos&&0===e.encoder.bufs.length?sg():(0,sr.Fo)(e.encoder);return sf.fromData("out",n,t)}static fromIncomingMessage(e,t){return sf.fromData("in",new Uint8Array(e),t)}static fromData(e,t,n){let s=(0,si.$C)(t),o=(0,si.t3)(s);switch((0,si.cw)(s)){case r.Sync:return new sm(o,e,s,n);case r.Awareness:return new sy(o,e,s,n);case r.Auth:return new sb(o,e,s,n);case r.QueryAwareness:return new sw(o,e,s,n);case r.Stateless:return new sv(o,e,s,n);case r.CLOSE:return new sS(o,e,s,n);case r.SyncStatus:return new sA(o,e,s,n);default:return new sf(o,e,n)}}constructor(e,t,n){this.docId=e,this.dir=t,this.timestamp=n,this.messageType=null,this.typeName="DebugHocuspocusMessage",this.transaction=null}}class sm extends sf{getPayload(){let{transaction:e}=this,t=null,n=null;if(0===this.syncStep){var s;s=this.update,t=JSON.stringify(sh(V.Zx(s)))}else this.syncStep>0&&(n=function(e){try{let t=V.W3(new Uint8Array(e));return{ds:JSON.stringify(sh(t.ds.clients)),structs:JSON.stringify(t.structs.map(sp))}}catch(e){return{}}}(this.update));let o={syncStepName:this.syncStepName,syncStep:this.syncStep,update:su(this.update),stateVector:t,decodedUpdate:n,transaction:null};return null!==e&&(o.transaction={beforeState:sd(e.beforeState),beforeStateSize:e.beforeState.size,afterState:sd(e.afterState),afterStateSize:e.afterState.size,changed:sd(e.changed),changedSize:e.changed.size,deleteSet:sd(e.deleteSet.clients),deleteSetSize:e.deleteSet.clients.size}),o}shouldAssociateTransaction(){return 2===this.syncStep}toString(){let e=super.toString();return"".concat(e," [step=").concat(this.syncStepName,"]")}constructor(e,t,n,s){super(e,t,s),this.messageType=r.Sync,this.typeName="Sync",this.syncStep=(0,si.cw)(n),this.syncStepName=0===this.syncStep?"SyncStep1":1===this.syncStep?"SyncStep2":"Update",this.update=(0,si.bo)(n)}}class sy extends sf{getPayload(){return{len:this.states.length,states:this.states}}constructor(e,t,n,s){super(e,t,s),this.messageType=r.Awareness,this.typeName="Awareness",this.states=[];let o=(0,si.bo)(n),i=(0,si.$C)(o),a=(0,si.cw)(i);for(let e=0;e<a;e++){let e=(0,si.cw)(i),t=(0,si.cw)(i),n=(0,si.t3)(i);this.states.push({clientId:e,clock:t,state:n})}}}class sb extends sf{getPayload(){return{authMessageType:this.authMessageTypeName,scope:this.scope}}toString(){let e=super.toString();return"".concat(e," [authType=").concat(this.authMessageTypeName,"]")}constructor(e,t,n,s){super(e,t,s),this.messageType=r.Auth,this.typeName="Auth",this.authMessageType=(0,si.cw)(n),this.authMessageTypeName=0===this.authMessageType?"Token":1===this.authMessageType?"PermissionDenied":"Authenticated",this.scope=(0,si.t3)(n)}}class sw extends sf{constructor(e,t,n,s){super(e,t,s),this.messageType=r.QueryAwareness,this.typeName="QueryAwareness"}}class sv extends sf{constructor(e,t,n,s){super(e,t,s),this.messageType=r.Stateless,this.typeName="Stateless"}}class sS extends sf{constructor(e,t,n,s){super(e,t,s),this.messageType=r.CLOSE,this.typeName="Close"}}class sA extends sf{getPayload(){return{saved:this.saved}}constructor(e,t,n,s){super(e,t,s),this.messageType=r.SyncStatus,this.typeName="SyncStatus",this.saved=1===(0,si.cw)(n)}}let sC=()=>{let e=(0,t_.useRef)(null);return{onTransaction:(0,t_.useCallback)(t=>{e.current=t},[]),getTransaction:(0,t_.useCallback)(()=>{let t=e.current;return e.current=null,t},[])}};class sx{onMessage(e){e.messageType!==r.Awareness&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift())}getMessages(){return this.buffer}flushMessages(){let e=this.buffer;return this.buffer=[],e}constructor(e=50){this.bufferSize=e,this.buffer=[]}}var sk=n(119),sE=n.n(sk);let sT=e=>{let[t,n]=(0,t_.useState)([]);return{logMessages:t,logPerfMessage:(0,t_.useCallback)(t=>{if(!e)return;let s=performance.now(),o={msg:t,timestamp:s};n(e=>0===e.length?[...e,o]:e.find(e=>e.msg===t)||e[e.length-1].msg===t?e:(o.duration=sE()(s-e[e.length-1].timestamp,2),[...e,o]))},[e]),dumpLog:(0,t_.useCallback)(()=>{e&&n(e=>{try{console.table(e)}catch(e){}return[]})},[e])}};var sP=n(32202),sD=n(95640),sM=n(39286),sO=n(55090);let sI="not-connecting-toast",s_=()=>(0,l.jsx)(n0.s,{direction:"column",p:4,color:"white",bg:"yellow.500",borderRadius:"md",children:(0,l.jsxs)(n0.s,{alignItems:"center",children:[(0,l.jsx)(p.y,{mr:4}),(0,l.jsxs)(d.az,{ml:3,children:[(0,l.jsx)(g.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:(0,l.jsx)(sD.x6,{id:"9tGBiL",values:{GAMMA_ARTIFACT_PROPER_NOUN:sM.TP}})}),(0,l.jsx)(g.E,{lineHeight:6,fontSize:"sm",children:(0,l.jsx)(sD.x6,{id:"xpqx+T"})})]})]})}),sR=e=>{let{enabled:t,docId:n}=e,s=(0,sP.d)(),o=(0,t_.useRef)(null),i=(0,t_.useCallback)(()=>{s.close(sI),o.current&&(clearTimeout(o.current),o.current=null)},[s]);return(0,t_.useEffect)(()=>{if(t)return o.current=setTimeout(()=>{s.isActive(sI)||(s({render:s_,duration:null,id:sI}),nN.yf.logger.info("Editor slow load toast shown",{event:sO.ng.EDITOR_SLOW_LOAD,docId:n}))},15e3),()=>{o.current&&(clearTimeout(o.current),o.current=null)}},[n,t,s]),i};var sN=n(91417),sU=n(77563),sL=n(6301),sj=n(54260),sz=n(50877),sH=n(5720),sF=n(15562);let sB=e=>{let t=(0,sU.A)(e);return 4>=Math.abs(function(e,t){(0,sj.A)(2,arguments);var n=(0,sL.A)(e,t)/36e5;return n>0?Math.floor(n):Math.ceil(n)}(new Date,t))},sV=(e,t)=>{let[n,s]=(0,t_.useState)(!1),o=(0,t_.useRef)(null);(0,t_.useEffect)(()=>{if(t){o.current&&clearTimeout(o.current),s(!1);return}return o.current=setTimeout(()=>{s(!0)},1e4),()=>{o.current&&clearTimeout(o.current)}},[t]);let i=(0,tV.GV)(sH.TT)[e];if(!i)return!1;let r=i.lastSynced;return!!(r&&sB(r))||n},sG=(e,t)=>{let{isInOfflineMode:n}=(0,sz.utY)(),s=(0,sF.O)(),o=(0,tV.GV)(sH.yy),i=sV(e,t);return n||(s||o)&&i};var sW=n(70323),s$=n(90290),sY=n(69648),sq=n(84607),sJ=n(39761),sQ=n(94259),sZ=n(12917),sK=n(24221),sX=n(22082);let s0=()=>!!window.navigator&&!1===window.navigator.onLine,s1=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e4,[t,n]=(0,t_.useState)(s0),s=(0,t_.useRef)(null);return(0,sX.LQ)("offline",()=>{s.current=setTimeout(()=>{n(!0)},e)}),(0,sX.LQ)("online",()=>{s.current&&(clearTimeout(s.current),s.current=null),n(!1)}),t};var s2=n(14979),s3=n(10458),s8=n(2696),s5=n(41057),s4=n(31757);let s7=async(e,t,n,s)=>{try{let{id:o,length:i}=n||{},r=await fetch("".concat(tN.$.MULTIPLAYER_WS_URL.replace("wss","https"),"/").concat(e,"/verify/").concat(t),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({id:o,length:i,clientCount:null==s?void 0:s.clientCount,totalCount:null==s?void 0:s.totalCount})});return await r.json()}catch(e){}},s6=e=>{let t=e.document.store.clients.get(e.document.clientID);if(t&&t.length)return t[t.length-1]},s9=e=>({clientCount:e.document.store.clients.size,totalCount:[...e.document.store.clients.values()].reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0)}),oe=async(e,t,n)=>{let s=s6(t),o=s9(t),i=await s7(e.gammaDocId,t.document.clientID,s,o);if(!i)return console.warn("[compareClocks] Failed to fetch remote clock"),!1;try{var r;let e=((null==s?void 0:s.id.clock)||0)+((null==s?void 0:s.length)||0),t=((null==i?void 0:null===(r=i.lastKnownItem.id)||void 0===r?void 0:r.clock)||0)+((null==i?void 0:i.lastKnownItem.length)||0),a=e-t;a>0&&console.warn("[compareClocks] Clock drift detected",{diffLastItem:a});let c=o.clientCount-(i.itemSummary.clientCount||0),l=o.totalCount-(i.itemSummary.totalCount||0);return c>0&&console.warn("[compareClocks] clientCount drift detected",{diffClientCount:c}),l>0&&console.warn("[compareClocks] totalCount drift detected",{diffTotalCount:l}),0===c&&l<=n&&a<=n}catch(e){console.warn("[compareClocks] Failed to fetch remote clock")}return!1},ot=e=>{let[t,n]=(0,t_.useState)(null==e?void 0:e.status);return(0,t_.useEffect)(()=>{if(!e)return;let t=e=>{let{status:t}=e;n(t)};return e.on("status",t),()=>{e.off("status",t)}},[e]),t},on=e=>{let{editor:t,yProvider:n,enabled:s}=e,o=(0,tV.CU)(),[i,r]=(0,t_.useState)(Date.now()),[a,c]=(0,t_.useState)(0),l=ot(n),[d,u]=(0,t_.useState)(s);(0,t_.useEffect)(()=>{if(!s){u(!1);return}u(!1);let e=tR.wg(()=>{u(!0)},5e3);return()=>{tR.DJ(e)}},[s,l]);let h=(0,tz.u)("dataSyncClockDriftTolerance"),p=(0,t_.useCallback)(async()=>{if(!t||!n||!t.gammaDocId)return;let{online:e,backgrounded:s}=(0,s4.mN)(o.getState());e&&!s&&(await oe(t,n,h)?(c(0),r(Date.now())):(c(e=>e+1),console.warn("[useDataPersistenceSync_2] Clocks out of sync for doc",t.gammaDocId)))},[h,t,o,n]),g=0===a?2e4:4e3;return(0,t_.useEffect)(()=>{if(!t||!n||!d)return;let e=setInterval(()=>{p()},g);return()=>{e&&clearInterval(e)}},[t,n,d,g,h,p]),{errorCount:a,yDocLastSynced:i,checkDataInSync:p}},os="data-sync-error-toast",oo="data-sync-not-saved-toast",oi=(0,l.jsx)(sK.g,{icon:sZ.lEd,size:"2x"}),or=(0,l.jsx)(sK.g,{icon:sZ.JAe,size:"2x"}),oa=e=>{let{type:t,yDocLastSynced:n}=e;return()=>(0,l.jsx)(n0.s,{direction:"column",p:4,color:"white",bg:"warn"===t?"yellow.500":"red.500",borderRadius:"md",children:(0,l.jsxs)(n0.s,{alignItems:"center",children:["warn"===t?oi:or,(0,l.jsxs)(d.az,{ml:3,children:[(0,l.jsx)(g.E,{lineHeight:6,fontSize:"sm",fontWeight:"bold",children:"warn"===t?(0,l.jsx)(sD.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:sM.On}}):(0,l.jsx)(sD.x6,{id:"DgKz0c",values:{GAMMA_PROPER_NOUN:sM.On}})}),n&&(0,l.jsx)(g.E,{lineHeight:6,fontSize:"sm",children:(0,l.jsx)(sD.x6,{id:"VxWwaW",values:{0:(0,s2.Bo)(new Date(n).toISOString())}})}),"error"===t&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(sW.c,{pt:2}),(0,l.jsx)(g.E,{lineHeight:6,fontSize:"sm",pt:2,children:(0,l.jsx)(sD.x6,{id:"Pw5K5r"})})]})]})]})})},oc=e=>{let{onClose:t}=e;return(0,l.jsxs)(s$.F,{variant:"light",status:"info",alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",children:[(0,l.jsx)(sY._,{}),(0,l.jsxs)(d.az,{flex:"1",maxWidth:"100%",children:[(0,l.jsx)(sq.X,{children:(0,l.jsx)(sD.x6,{id:"BM8j3v",values:{GAMMA_PROPER_NOUN:sM.On}})}),(0,l.jsx)(sJ.T,{display:"block",children:(0,l.jsx)(sD.x6,{id:"I1QCnH"})})]}),(0,l.jsx)(sQ.J,{size:"sm",onClick:t,position:"absolute",insetEnd:1,top:1})]})},ol=e=>{let{enabled:t,errorCount:n,errorCountThreshold:s,isPresentModeAndNotEditing:o,background:i,offline:r}=e;return!t||o||i||r||-1===s?"ignored":n>2*s?"error":n>s?"warn":"ok"},od=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,[t,n]=(0,t_.useState)(!0),s=(0,t_.useRef)(null);return(0,sX.LQ)("foreground",t=>{let{timeInBackground:o}=t;if(null===o){n(!0);return}if(o>6e4){s.current=setTimeout(()=>{n(!0)},e);return}n(!0)}),(0,sX.LQ)("background",()=>{s.current&&(clearTimeout(s.current),s.current=null),n(!1)}),t},ou=e=>{let{offline:t,yDocLastSynced:n}=e,s=(0,sP.d)(),[o,i]=(0,t_.useState)(!1),r=(0,sF.O)(),a=(0,tV.GV)(sH.yy),c=(r||a)&&!t;return(0,t_.useMemo)(()=>({warnOrError:e=>{if(c)return!s.isActive(oo)&&!o&&(s({id:oo,duration:null,render:e=>{let{onClose:t}=e;return oc({onClose:()=>{t(),i(!0)}})}}),!0);let t=oa({type:e,yDocLastSynced:n});return s.isActive(os)?(s.update(os,{render:t}),!1):(s({render:t,duration:null,id:os}),!0)},recovered:e=>(c?!!s.isActive(oo)||!!o:!!s.isActive(os))&&((s.isActive(os)||s.isActive(oo))&&s.closeAll(),"ignored"!==e&&(c&&(s({title:(0,l.jsx)(sD.x6,{id:"flElqq",values:{GAMMA_PROPER_NOUN:sM.On}}),description:(0,l.jsx)(sD.x6,{id:"Gm5OG1"}),status:"success",duration:5e3,id:"data-sync-saved-toast",isClosable:!0}),i(!1)),!0))}),[o,s,c,n])},oh=e=>{let{editor:t,yProvider:n,enabled:s}=e,o=(0,tV.GV)(nZ.VJ),i=(0,s8.UT)("comment"),r=(0,tV.GV)(nZ.jn),a=(0,s3.st)(),{user:c}=(0,t$.ur)(),l=(0,t_.useRef)(),d=(0,tz.u)("dataSyncErrorThreshold"),{errorCount:u,yDocLastSynced:h}=on({editor:t,yProvider:n,enabled:s&&i}),p={docSavedTime:r,yDocLastSynced:h,errorCount:u,clientID:null==n?void 0:n.document.clientID,userId:null==c?void 0:c.id},g=(0,t_.useRef)(p);g.current=p;let f=s1(),m=od(),y=(0,t_.useRef)();y.current={errorCount:u,enabled:s,errorCountThreshold:d,isPresentModeAndNotEditing:o,background:!m,offline:f};let b=ol(y.current),w=ou({offline:f,yDocLastSynced:h});return(0,s5.V)(()=>{if("ok"===b||"ignored"===b){if(!w.recovered(b))return;let e=l.current?+new Date-+l.current:void 0;null==a||a.trackDocEvent(s3.ng.DATA_SYNC_RECOVER,{...g.current,duration:e}),nN.yf.logger.info("Data sync recovered",{event:s3.ng.DATA_SYNC_RECOVER,docId:null==t?void 0:t.gammaDocId,errorStatusInput:y.current,docEventData:g.current}),l.current=void 0;return}w.warnOrError(b)&&(null==a||a.trackDocEvent(s3.ng.DATA_SYNC_ERROR,g.current),nN.yf.logger.info("Data sync error",{event:s3.ng.DATA_SYNC_ERROR,docId:null==t?void 0:t.gammaDocId,dataSyncErrorType:b,errorStatusInput:y.current,docEventData:g.current}),"error"===b&&nU.Cp("[useDataPersistenceSync] ERROR_THRESHOLD_EXCEEDED. docId: ".concat(null==t?void 0:t.gammaDocId)))},[a,null==t?void 0:t.gammaDocId,b,w],[b]),"error"===b},op=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=(0,t_.useRef)(0),s=(0,t_.useRef)(0),[o,i]=(0,t_.useState)(!1),[r,a]=(0,t_.useState)(0),[c,l]=(0,t_.useState)(document.hidden),d=(0,t_.useRef)(()=>{n.current++,n.current>=t&&(console.warn("[useRateLimiter] Limit hit! (".concat(t," per ").concat(e/1e3,"s)")),o||(i(!0),a(e=>e+1))),s.current||(s.current=tR.yb(()=>{n.current>0?n.current--:(i(!1),tR.vG(s.current),s.current=0)},e/t))});return(0,t_.useEffect)(()=>{let e=()=>{l(document.hidden),d.current()};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)},[]),[d.current,o,r,c]};var og=n(2600),of=n(80853);let om=()=>(0,l.jsxs)(og.T,{align:"flex-end",borderRadius:"base",shadow:"lg",p:3,bg:"gray.100",spacing:4,maxW:"300px",direction:"row",children:[(0,l.jsxs)(d.az,{children:[(0,l.jsx)(g.E,{fontSize:"md",fontWeight:"bold",children:(0,l.jsx)(sD.x6,{id:"8kh5VW",values:{GAMMA_PROPER_NOUN:sM.On}})}),(0,l.jsxs)(g.E,{fontSize:"sm",children:[(0,l.jsx)(sD.x6,{id:"CDva2g"})," ",(0,l.jsx)("em",{children:(0,l.jsx)(sD.x6,{id:"/vuJlA"})})," ","\uD83D\uDE0E"]})]}),(0,l.jsx)(d.az,{children:(0,l.jsx)(of.$,{size:"sm",onClick:()=>{window.location.reload()},children:(0,l.jsx)(sD.x6,{id:"HpK/8d"})})})]}),oy=e=>{let t=(0,sP.d)(),[n,s]=(0,t_.useState)(!1);return(0,t_.useEffect)(()=>{if(!e)return;let t=()=>{let t=e.getMap("SCHEMA_VERSION").get("REQUIRED_VERSION"),n=!!(t&&t>nK.f$);s(n),console[n?"warn":"debug"]("[SchemaVerifier] onUpdate",{requiredVersion:t,MY_VERSION:nK.f$,outdated:n})};return e.on("update",t),()=>{e.off("update",t)}},[e]),(0,t_.useEffect)(()=>{n&&!t.isActive("schema_outdated")&&t({id:"schema_outdated",duration:null,status:"warning",isClosable:!1,position:"bottom-left",render:om})},[n,t]),n},ob="staging"===tN.$.APPLICATION_ENVIRONMENT&&tN.$.API_HOST.endsWith("api-custom-backend.staging.gamma.app"),ow=e=>({DOC_ID:e,SCHEMA_VERSION:String(nK.f$),SHARE_TOKEN:tN.$.SHARE_TOKEN,...ob?{API_HOST:tN.$.API_HOST}:{}}),ov=(0,t_.memo)(e=>{let{doc:t,docId:n,onCreate:s,readOnly:o=!1,scrollingParentSelector:i,hideForPreview:r=!1,animationsExtensionEnabled:a=!1}=e,[c]=(0,t_.useState)(()=>performance.now()),{timeOnCreate:f,timeOnSetupProvider:m,timeOnDownloadDoc:y}=(0,tB.n6)(),b=(0,tG.rd)(),{isUserLoading:w}=(0,t$.ur)(),[v,S]=(0,t_.useState)(!1),A=(0,t_.useRef)(!1);A.current=v;let[C,x]=(0,t_.useState)(!1),[k,E]=(0,t_.useState)(!1),T=(0,t_.useRef)([]),[P,D]=(0,t_.useState)(),[M,O]=(0,t_.useState)(),[I,_]=(0,t_.useState)(),[R]=(0,t_.useState)(()=>new sx),{onTransaction:N,getTransaction:U}=sC(),L=(0,tF.iJ)(),j=(0,tF.iO)(),{isConnected:z}=(0,tL.u)(),F=sG(n,C),B=oy(M);so(P,I);let G=oh({editor:P,yProvider:I,enabled:C&&!o});(0,nQ.Rf)(P);let[W,$,Y,q]=op(),J=t&&t.organization&&t.organization.id,Q=sR({docId:n,enabled:!C}),Z=(0,tH.u)("debugLogging"),K=(0,tV.GV)(tz.Gm),X=(0,tH.u)("waitForGammaPersistenceMeta"),ee=(0,tV.jL)(),{logMessages:et,logPerfMessage:en,dumpLog:es}=sT(Z);(0,tY.C)((0,t_.useCallback)(()=>{I&&(I.disconnect(),I.configuration.parameters=ow(n),setTimeout(()=>I.connect(),500))},[I,n])),(0,tU.A)(),(0,sN.W)(P),(0,t_.useEffect)(()=>{let e;if(!I)return;let t=Y>10;if($){console.warn("[CollaborativeEditor] Attempted to re-connect while rate limited (".concat(Y," of ").concat(10,").")),I.disconnect();return}if(t){console.error("[CollaborativeEditor - RECONNECT_RATE_LIMIT] Max rate limit violations reached (".concat(10,"). Will reload.")),setTimeout(()=>{window.location.reload()},500);return}if(A.current)return q?(console.debug("[CollaborativeEditor] Backgrounded, will wait ".concat(12e4,"s before disconnect")),e=tR.wg(()=>{console.debug("[CollaborativeEditor] Disconnecting after grace period"),I.disconnect()},12e4)):(console.debug("[CollaborativeEditor] Foregrounded, so re-connecting"),I.connect()),()=>{e&&tR.DJ(e)}},[I,q,$,Y]),(0,t_.useEffect)(()=>{P&&!P.isDestroyed&&J&&(P.commands.initializeUploadExtension(J),P.commands.removeGeneratorInputsOnLoad())},[P,J]),(0,t_.useEffect)(()=>{M&&n&&F&&L.loadYDoc(n,M,()=>{console.debug("offlineMode - [ydocOfflineApi] YDoc loaded from indexeddb"),x(!0),S(!0)})},[F,M,n,L]),(0,t_.useEffect)(()=>{console.debug("[CollaborativeEditor] Creating yProvider for doc",n);let e=new V.JA({});e.getXmlFragment("default").observeDeep((e,t)=>{N(t)}),O(e),e.getMap("GammaPersistenceMeta").observeDeep((t,n)=>{e.getMap("GammaPersistenceMeta").get("READY")&&(en("Document data downloaded"),E(!0))}),en("Setting up hocuspocus"),m();let t=new tO({name:n,document:e,forceSyncInterval:15e3,token:ow(n).SHARE_TOKEN||"null",websocketProvider:new th({url:tN.$.MULTIPLAYER_WS_URL,parameters:ow(n)}),preserveConnection:!1,onOutgoingMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-c),n=sf.fromOutgoingMessage(t,e);n.shouldAssociateTransaction()&&n.setTransaction(U()),R.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing outgoing message for debug",e)}},onMessage(e){let{message:t}=e;try{let e=Math.floor(performance.now()-c),n=sf.fromIncomingMessage(t.data,e);n.shouldAssociateTransaction()&&n.setTransaction(U()),R.onMessage(n)}catch(e){console.error("[CollaborativeEditor] Error processing incoming message for debug",e)}},onOpen(){if(!0===tz.of.get("hocuspocusOnAuthenticate")){console.log("[CollaborativeEditor] Provider opened. onAuthenticate is enabled so this is a no-op.");return}t.isAuthenticated=!0,console.log("[CollaborativeEditor] Provider opened.  Setting isAuthenticated to true.")},onStatus(e){let{status:t}=e;console.debug("[CollaborativeEditor][onStatus]",{status:t}),"connected"===t?(en("Hocuspocus connected"),S(!0),A.current=!0):"connecting"===t&&(en("Hocuspocus connecting"),W())},onSynced(){console.debug("[CollaborativeEditor] Provider synced"),x(!0),Q(),en("Document data downloaded"),L.syncYDoc(n,e)},onDisconnect(e){let{event:n}=e;n.code===H.code?console.error('[CollaborativeEditor] Provider disconnected with "Unauthorized.code", which is unexpected.',n):1008===n.code&&(t.disconnect(),tJ.LF.emit(tJ.DN.Y_DOC_IS_TOO_LARGE,{}),console.error("[CollaborativeEditor][onDisconnect] Document is too large, disconnecting"))}});return t.subscribeToBroadcastChannel(),_(t),ee((0,nZ.gS)({hocuspocusProvider:t})),tN.$.DEBUG_ENABLED&&(window.gammaEditorProvider=t),T.current=[...a?[nn.Q]:[],nG.EX,nY.q,nQ.Li.configure({scrollerSelector:i}),nd.O.configure({document:e}),nu.F,tQ.b.configure({provider:t}),nM.configure({provider:t}),ns.T.configure({document:e}),ni.$,nr.R,no.$.configure(),ne,na.mM,nJ.V,tZ.d.configure({document:e}),nt.e,n$.c,nR.mk,nW.Q8,nB.wg,nq.bU,tI.o5.configure({openDoubleQuote:!1,closeDoubleQuote:!1,openSingleQuote:!1,closeSingleQuote:!1}),n_.configure({scrollerSelector:i}),tK.j,nl.p,nc.c,nV.H,tW.o.configure({document:e}),nF.configure({startTime:c,messageLogger:R,provider:t})],()=>{console.warn("[CollaborativeEditor] Destroying yProvider for doc ➡️",n),t.disconnect(),t.destroy(),delete window.gammaEditorProvider,_(void 0),x(!1),S(!1),E(!1),setTimeout(()=>{if(t&&t.awareness)try{t.awareness.destroy()}catch(e){console.warn("[CollaborativeEditor] Error destroying awareness provider.")}})}},[]);let eo=!!(v&&C&&(!X||k)&&t&&!w);(0,t_.useEffect)(()=>{eo&&(en("Is ready for TipTap"),y())},[eo,y,en]);let ei=(0,tj.K)();return(0,l.jsxs)(d.az,{display:r?"none":"block",w:"100%","data-testid":"collaborative-editor-wrapper",children:[eo&&K&&(0,l.jsx)(n5,{editor:P}),!P&&(0,l.jsx)(d.az,{flexDirection:"column",flex:"1",w:"100%",h:"var(--100vh)",bg:b?"gray.900":"gray.100",zIndex:"overlay","data-testid":"collaborative-editor-skeleton",inset:0,children:(0,l.jsx)(u.o,{h:"100%",children:(0,l.jsxs)(h.B,{align:"center",children:[(0,l.jsx)(p.y,{}),et.map((e,t)=>{let{msg:n}=e;return(0,l.jsx)(g.E,{children:n},t)})]})})}),eo&&(0,l.jsx)(tq.b,{extensions:T.current,doc:t,docId:n,editorId:"main",onCreate:e=>{let{editor:t}=e;setTimeout(()=>{D(t),s&&s(t),requestAnimationFrame(()=>{z&&j(n),ei(t),en("Editor rendered"),f(),es()})},10)},readOnly:B||o||!F&&G,shouldSupportComments:!0,shouldSupportMenus:!0,scrollingParentSelector:i})]})});var oS=n(89876),oA=n(85500)},55098:(e,t,n)=>{"use strict";n.d(t,{f$:()=>o}),n(57267);let s=new URLSearchParams(window.location.search),o=(s.get("SCHEMA_VERSION")?Number(s.get("SCHEMA_VERSION")):null)||120}}]);
//# sourceMappingURL=3842-57b3f7b31b9d3c8b.js.map